import{i as m,o as s,k as a,N as v,h as g,u as P,aY as h,p as M,l as d,a as f,b as l,c as T,v as O,w as U}from"./C4ENrkrF.js";import"./DsnmJJEf.js";import{i as _}from"./Xxn1VSU5.js";import{w as u,b as N,h as w}from"./Cw4pjOYq.js";import"./CdVPB6xn.js";class y{#e=m(void 0);constructor(t,n){n!==void 0&&s(this.#e,n,!0),u(()=>t(),(r,i)=>{s(this.#e,i,!0)})}get current(){return a(this.#e)}}function z(e){v().then(e)}class b{state;#e;constructor(t,n){this.state=N(t),this.#e=n,this.dispatch=this.dispatch.bind(this)}#t(t){return this.#e[this.state.current][t]??this.state.current}dispatch(t){this.state.current=this.#t(t)}}const C={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}};class I{opts;#e=m("none");get prevAnimationNameState(){return a(this.#e)}set prevAnimationNameState(t){s(this.#e,t,!0)}#t=m(g({}));get styles(){return a(this.#t)}set styles(t){s(this.#t,t,!0)}initialStatus;previousPresent;machine;present;constructor(t){this.opts=t,this.present=this.opts.open,this.initialStatus=t.open.current?"mounted":"unmounted",this.previousPresent=new y(()=>this.present.current),this.machine=new b(this.initialStatus,C),this.handleAnimationEnd=this.handleAnimationEnd.bind(this),this.handleAnimationStart=this.handleAnimationStart.bind(this),E(this),x(this),k(this)}handleAnimationEnd(t){if(!this.opts.ref.current)return;const n=o(this.opts.ref.current),r=n.includes(t.animationName)||n==="none";t.target===this.opts.ref.current&&r&&this.machine.dispatch("ANIMATION_END")}handleAnimationStart(t){this.opts.ref.current&&t.target===this.opts.ref.current&&(this.prevAnimationNameState=o(this.opts.ref.current))}#n=P(()=>["mounted","unmountSuspended"].includes(this.machine.state.current));get isPresent(){return a(this.#n)}set isPresent(t){s(this.#n,t)}}function E(e){u(()=>e.present.current,()=>{if(!e.opts.ref.current||!(e.present.current!==e.previousPresent.current))return;const n=e.prevAnimationNameState,r=o(e.opts.ref.current);if(e.present.current)e.machine.dispatch("MOUNT");else if(r==="none"||e.styles.display==="none")e.machine.dispatch("UNMOUNT");else{const i=n!==r;e.previousPresent.current&&i?e.machine.dispatch("ANIMATION_OUT"):e.machine.dispatch("UNMOUNT")}})}function x(e){u(()=>e.machine.state.current,()=>{if(!e.opts.ref.current)return;const t=o(e.opts.ref.current);e.prevAnimationNameState=e.machine.state.current==="mounted"?t:"none"})}function k(e){u(()=>e.opts.ref.current,()=>{if(e.opts.ref.current)return e.styles=getComputedStyle(e.opts.ref.current),w(h(e.opts.ref.current,"animationstart",e.handleAnimationStart),h(e.opts.ref.current,"animationcancel",e.handleAnimationEnd),h(e.opts.ref.current,"animationend",e.handleAnimationEnd))})}function o(e){return e&&getComputedStyle(e).animationName||"none"}function B(e,t){M(t,!0);const n=new I({open:N.with(()=>t.open),ref:t.ref});var r=d(),i=f(r);{var A=c=>{var p=d(),S=f(p);O(S,()=>t.presence??U,()=>({present:n.isPresent})),l(c,p)};_(i,c=>{(t.forceMount||t.open||n.isPresent)&&c(A)})}l(e,r),T()}export{B as P,z as a,y as b};
